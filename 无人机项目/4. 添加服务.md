## 公共部分-srv类型

colcon build --symlink-install # 符号链接
添加
服务数据类型：**ControlService.srv**
```
string req   # send to service  # 发送给服务器的内容
---
string echo  # return from service # 服务器返回的内容

# 使用 from uav_car_interfaces.srv import ControlService
```

CMakeLists.txt添加：
```CMake
#  add message / service dependencies !!!
rosidl_generate_interfaces(${PROJECT_NAME}
"msg/T265Data.msg"
"msg/ImageProcessorData.msg"
"srv/ControlService.srv"
 )
```

##  服务端修改：

1. navigator.py

```python
建议： 直接不做处理，进行转发，除了关键指令： takeoff  land 之类的
    def takeoff_callback(self, request, response):
        if request.req == 'takeoff':
          # wait for camera and t265 to be ready  
          ur.uart_sender3_send(self, "52 ") # 0x52  0x40~0x7F都可以，也可以自己设计通信帧头

        elif request.req == 'land': # 降落指令 land
          ur.uart_sender4_send(self, "53 ") # 0x53  # 可以这么排到0x7F  

        else:
          ur.uart_sender4_send(self, request.req) #  0x41~0xFF都可以，也可以自己设计通信帧头， 不要和 fly_path的msg内容重合即可 @#.+-0~9 不要出现
```



## 地面端修改：

1. ros2_ground_station.py
```python
def create_services(self):
	"""创建服务和客户端"""
	# 起飞服务客户端地面站 # 起飞服务客户端地面站# 起飞服务客户端地面站 
	self.takeoff_client = self.create_client(Empty, 'takeoff_service')
	self.get_logger().info('服务客户端创建完成')

def call_takeoff_service(self):
	"""调用起飞服务"""
	if not self.takeoff_client.wait_for_service(timeout_sec=1.0):
		self.get_logger().error('起飞服务不可用')
		return False
	request = Empty.Request()
	future = self.takeoff_client.call_async(request)
	# 这里可以添加回调处理
	self.get_logger().info('起飞服务请求已发送')
	return True
	
	
---改之后---

from uav_car_interfaces.srv import ControlService

#创建两个成员变量 不创建了，直接临时变量即可， 避免出错
#self.CS_request = ControlService.Request()
#self.CS_response = ControlService.Response()

def create_services(self):
	"""创建服务和客户端"""
	# 起飞服务客户端地面站 # 起飞服务客户端地面站# 起飞服务客户端地面站 
	self.takeoff_client = self.create_client(ControlService, 'takeoff_service')
	self.get_logger().info('服务客户端创建完成')

---

def call_takeoff_service(self, req):
	"""调用xxx服务"""
	if not self.takeoff_client.wait_for_service(timeout_sec=1.5):
		self.get_logger().error('起飞服务不可用')
		return False
	request = ControlService.Request()
	request.req = req
	#if req == "takeoff":
	future = self.takeoff_client.call_async(request)
	# future.add_done_callback(self.your_callback) # full async callback # 这里可以添加回调处理
	self.get_logger().info('起飞服务请求已发送')
	return True
#def your_callback(self,future):
#	# self.response = future.result()
#	self.get_logger().info(f'Received reply: "{future.result().echo}"')

--- 

colcon build --symlink-install # 符号链接
``` 


---
飞行端启动器
```python  launch.py
from launch import LaunchDescription
from launch_ros.actions import Node

def generate_launch_description():
    # 参数文件的绝对路径
    # linktrack_param_file_uwb = "/home/orangepi/Desktop/UAV_CAR__Test/UAV_CAR/src/nlink_parser_ros2/params/linktrack_init_params.yaml"
    # linktrack_param_file_lidar = "/home/orangepi/Desktop/UAV_CAR__Test/UAV_CAR/src/bluesea-ros2/bluesea-ros2/params/uart_lidar.yaml"
    # 定义所有节点
    return LaunchDescription([
        # 添加 linktrack 节点
        # Node(
        #     package="nlink_parser_ros2",
        #     executable="linktrack",
        #     output="screen",
        #     arguments=[linktrack_param_file_uwb]
        # ),
        # Node(
        #     node_name="bluesea_node",
        #     package="bluesea2",
        #     executable="bluesea2_node",
        #     output="screen",
        #     parameters=[linktrack_param_file_lidar]
        # ),
        Node(
            package='uav_car',
            executable='uart_sender3',
        ),
        Node(
            package='uav_car',
            executable='uart_sender4',
        ),
        # Node(
        #     package='uav_car',
        #     executable='uart_sender0',
        # ),
        # Node(
        #     package='uav_car',
        #     executable='uwb',
        # ),
        Node(
            package='uav_car',
            executable='t265',
        ),

        Node(
            package='uav_car',
            executable='camera',
        ),
        Node(
            package='uav_car',
            executable='image_processor',
        ),

        Node(
            package='uav_car',
            executable='navigator',
        ),
    ])

```