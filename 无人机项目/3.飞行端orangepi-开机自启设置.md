mobaxterm连接orangepi后，默认在路径/home/orangepi




常用指令：
+ sudo ./start_uav.sh 启动飞行站服务,密码为orangepi，方便观察命令行日志输出

手动调试 使用./start_uav.sh脚本，内容如下： 
> cat ./start_uav.sh 

```bash 
#!/bin/bash
bash /home/orangepi/Desktop/UAV_CAR__Test/config/uav_car.sh
```

## 开机启动方案（原版）

> 确定服务没问题，使能开机自启
+ systemctl enable uav_car.service  使能开机自启 飞行站服务
+ systemctl list-units --type=service | grep uav 查询服务状态
+ systemctl status uav_car.service 查询服务状态
+ systemctl stop uav_car.service 单次关闭飞行站服务
+ systemctl start uav_car.service 单次启动飞行站服务
+ systemctl restart uav_car.service  重启服务
+ systemctl disable uav_car.service 关闭开机自启 飞行站服务

### 开机自启 实现逻辑
主要文件：
+ /etc/systemd/system/uav_car.service
+ /etc/uav_car.local
+ /home/orangepi/Desktop/UAV_CAR__Test/config/uav_car.sh



 systemctl stop  uav_car.service && systemctl daemon-reload &&  systemctl restart  uav_car.service


  cat /etc/systemd/system/uav_car.service #可行
```bash
[Unit]
Description=uav_car飞行站开机自启服务
ConditionPathExists=/etc/uav_car.local

[Service]
User=root
Type=forking
ExecStartPre=/bin/sleep 3
ExecStart=/etc/uav_car.local start
TimeoutSec=0
StandardOutput=tty
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target

```

cat /etc/systemd/system/muav_car.service #不可行
```bash
[Unit]
Description=uav_car飞行站开机自启服务

[Service]
Uset=root
Type=simple # forking
ExecStartPre=/bin/sleep 3
ExecStart=/home/orangepi/Desktop/UAV_CAR__Test/uav_start.sh

TimeoutSec=0
StandardOutput=tty
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
```

---

>cat /etc/uav_car.local
```bash
#!/bin/bash
# uav_car.local
# bash /home/orangepi/Desktop/UAV_CAR__Test/config/uav_car.sh

bash /home/orangepi/Desktop/UAV_CAR__Test/uav_start.sh
```

>cat /home/orangepi/Desktop/UAV_CAR__Test/config/uav_car.sh
```bash
#! /bin/bash

export ROS_LOG_DIR=/home/orangepi/Desktop/UAV_CAR__Test/run_log

export LD_PRELOAD=/usr/local/lib/python3.8/dist-packages/torch.libs/libgomp-d22c30c5.so.1.0.0

source /opt/ros/foxy/setup.sh
source /home/orangepi/Desktop/UAV_CAR__Test/UAV_CAR/install/setup.bash 

# gpio mode 2 out
# gpio write 2 0

# cd /dev
# sudo chmod 777 gpiochip0
ros2 launch uav_car_launch uav_car_drone.launch.py
```

### 新写的 uav_launch.sh：使用相对路径：
```bash
#!/bin/bash

# 获取当前脚本所在目录的绝对路径（处理软链接等情况更健壮）
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
echo '当前脚本所在目录: '$SCRIPT_DIR
# 获取父目录
PARENT_DIR="$(dirname "$SCRIPT_DIR")"
echo '当前脚本所在目录的父目录: '$PARENT_DIR


echo "$(date): systemclt ok" >> $SCRIPT_DIR/ok.txt # 双引号可以 解析 data
# 当前脚本所在目录: /home/orangepi/Desktop/UAV_CAR__Test
# 当前脚本所在目录的父目录:  /home/orangepi/Desktop

# 添加 pyrealsense2 t265动态库到环境变量，避免找不到
export PYTHONPATH=$PYTHONPATH:/usr/lib/python3.8/site-packages/pyrealsense2

#  ros2项目环境初始化
source /opt/ros/foxy/setup.sh
source "$SCRIPT_DIR/UAV_CAR/install/setup.bash"
echo 'systemclt source ok' >> $SCRIPT_DIR/ok.txt


#  启动ros2项目
exec ros2 launch uav_car_launch uav_car_drone.launch.py
# echo 'systemclt launch ok' >> $SCRIPT_DIR/ok.txt
```
---
```bash
orangepi@orangepi5b:~$ systemctl status  uav_car.service
● uav_car.service - uav_car飞行站开机自启服务
     Loaded: loaded (/etc/systemd/system/uav_car.service; enabled; vendor preset: enabled)
     Active: activating (start) since Tue 2026-01-06 22:03:17 CST; 31s ago
    Process: 958 ExecStartPre=/bin/sleep 3 (code=exited, status=0/SUCCESS)
Cntrl PID: 1742 (uav_car.local)
      Tasks: 71 (limit: 9041)
     Memory: 483.2M
     CGroup: /system.slice/uav_car.service
             ├─1742 /bin/bash /etc/uav_car.local start
             ├─1745 /usr/bin/python3 /opt/ros/foxy/bin/ros2 launch uav_car_launch uav_car_drone.launch.py
             ├─2349 /usr/bin/python3 /home/orangepi/Desktop/UAV_CAR__Test/UAV_CAR/install/uav_car/lib/uav_car/uart_sender3 --ros-args
             ├─2351 /usr/bin/python3 /home/orangepi/Desktop/UAV_CAR__Test/UAV_CAR/install/uav_car/lib/uav_car/uart_sender4 --ros-args
             ├─2353 /usr/bin/python3 /home/orangepi/Desktop/UAV_CAR__Test/UAV_CAR/install/uav_car/lib/uav_car/t265 --ros-args
             ├─2355 /usr/bin/python3 /home/orangepi/Desktop/UAV_CAR__Test/UAV_CAR/install/uav_car/lib/uav_car/camera --ros-args
             ├─2357 /usr/bin/python3 /home/orangepi/Desktop/UAV_CAR__Test/UAV_CAR/install/uav_car/lib/uav_car/image_processor --ros-args
             └─2359 /usr/bin/python3 /home/orangepi/Desktop/UAV_CAR__Test/UAV_CAR/install/uav_car/lib/uav_car/navigator --ros-args

Jan 06 22:03:17 orangepi5b systemd[1]: Starting uav_car飞行站开机自启服务...

```

---
## 说明

+ _export_ 将变量声明为环境变量，使其在当前 Shell 及其子进程中可用。
+ _source_ 在当前 Shell 中执行脚本文件，而不启动新的子 Shell。


sh脚本设置相对路径变量：
```bash
#!/bin/bash

source /opt/ros/foxy/setup.sh

# 获取当前脚本所在目录的绝对路径（处理软链接等情况更健壮）
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
echo 'current dir is: '$SCRIPT_DIR

# 获取上一层目录并赋值给一个变量
PARENT_DIR=$(dirname "$SCRIPT_DIR") ## 父目录获取
echo 'PARENT_DIR is: '$PARENT_DIR

# 父目录下的子目录
ROS_LOG_DIR=$PARENT_DIR/run_log ## 子目录run_log
echo 'ROS_LOG_DIR dir is: '$ROS_LOG_DIR
export ROS_LOG_DIR=$PARENT_DIR/run_log

# ros启动脚本路径
STEUP_path=$PARENT_DIR/UAV_CAR/install/setup.bash 
echo 'STEUP_path is:'$STEUP_path
source $STEUP_path

# 最后启动ros2服务....
ros2 launch uav_car_launch uav_car_drone.launch.py
```

