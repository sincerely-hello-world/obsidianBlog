+ drv_uart2  接受坐标/ 特殊任务 状态切换

+ drv_uart7   t265 坐标信息  周期性通信
+ Modes M37.c 主任务 主控制循环



 Lock 锁机制， 上锁，锁定某一方向




下文所指函数/变量，一般都在 M37.c文件
---
# 主要执行逻辑： 
    注册函数，然后在主循环调用

+ 信息处理，（t265 路径规划坐标）全在串口回调， 

+ 任务跳转，都在这个mode注册的 main函数内？

![](assets/飞控板主函数/file-20251129201117645.png)
# M37_Liu_enter()
+ 初始化成员变量
+ 初始化 “控制结构体” Mode_Inf

## Mode_Inf 结构体
```c
typedef struct
{
	// 退出模式计数器
	uint16_t exit_mode_counter;

	bool start_Lock;

	float target_x; 
	float target_y;
	float target_z; // 目标坐标坐标

	float target_yaw; // 目标偏航

	bool posiyion_lock; // xy位置锁定
	bool height_lock;	// z位置锁定
	bool yaw_lock;		// yaw角锁定

	int zhu_distance; // 柱子间的距离

	int zt; // 状态：任务状态   重要！跳转状态！

	int listen; // ？聆听任务状态，用于观察Jetson执行到哪一步了

	int count; // 50Hz 1s计数50下，用于摇晃飞机; 或是起飞延迟计数
} MODE_INF;

static MODE_INF *Mode_Inf; // 指针
```

## 其他变量/宏定义

```json
#define TAKEOFF_HEIGHT 100.0f  //起飞高度 单位cm
#define HEIGHT 100.0f          //悬停高度 单位cm 后续高度直接调用这个变量 
```



# M37_Liu_MainFunc()
主函数 static void M37_Liu_MainFunc()
+ 被注册在循环中，大约20ms/次， 50H的执行频率。
+ 控制任务执行状态



## 状态选择/状态切换


 
