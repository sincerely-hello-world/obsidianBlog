## 公共部分-srv类型添加
服务数据类型：**ControlService.srv**
```
string req   # send to service  # 发送给服务器的内容
---
string echo  # return from service # 服务器返回的内容
```



##  服务端修改：

1. navigator.py

```python
第46行左右：
self.takeoff_service = self.create_service(Empty, "takeoff_service", self.takeoff_callback)

第96行左右：
def takeoff_callback(self, request, response):  # FIXME 回调：起飞

	self.get_logger().warning("takeoff service called")

	# wait for camera and t265 to be ready

	msg = "52 "  

	ur.uart_sender3_send(self, msg)  

	return response

---改之后---
from uav_car_interfaces.srv import ControlService

self.takeoff_service = self.create_service(ControlService, "takeoff_service", self.takeoff_callback)

---
def takeoff_callback(self, request, response):  # FIXME 回调：起飞
	self.get_logger().warning(f"{request.req} service called!!!")
	
    if request == "takeoff": # 纯字符串数据。起飞指令：'takeoff'不多空格
		ur.uart_sender3_send(self, "52 ")  # 让串口发送 起飞cmd 给 MCU控制板
		response = f'{request.req}OK' # 返回 请求字符串+OK大写字母，表示收到消息，已经执行
	
	return response

```



## 地面端修改：

1. ros2_ground_station.py
```python
def create_services(self):
	"""创建服务和客户端"""
	# 起飞服务客户端地面站 # 起飞服务客户端地面站# 起飞服务客户端地面站 
	self.takeoff_client = self.create_client(Empty, 'takeoff_service')
	self.get_logger().info('服务客户端创建完成')

def call_takeoff_service(self):
	"""调用起飞服务"""
	if not self.takeoff_client.wait_for_service(timeout_sec=1.0):
		self.get_logger().error('起飞服务不可用')
		return False
	request = Empty.Request()
	future = self.takeoff_client.call_async(request)
	# 这里可以添加回调处理
	future.add_done_callback(self.empty_callback) # full async callback
	self.get_logger().info('起飞服务请求已发送')
	return True
	
	
---改之后---

from uav_car_interfaces.srv import ControlService

#创建两个成员变量 不创建了，直接临时变量即可， 避免出错
#self.CS_request = ControlService.Request()
#self.CS_response = ControlService.Response()

def create_services(self):
	"""创建服务和客户端"""
	# 起飞服务客户端地面站 # 起飞服务客户端地面站# 起飞服务客户端地面站 
	self.takeoff_client = self.create_client(ControlService, 'takeoff_service')
	self.get_logger().info('服务客户端创建完成')

---

def call_takeoff_service(self, req):
	"""调用xxx服务"""
	if not self.takeoff_client.wait_for_service(timeout_sec=1.5):
		self.get_logger().error('起飞服务不可用')
		return False
	request = ControlService.Request()
	request.req = req
	#if req == "takeoff":
	future = self.takeoff_client.call_async(request)
	# future.add_done_callback(self.your_callback) # full async callback # 这里可以添加回调处理
	self.get_logger().info('起飞服务请求已发送')
	return True
	
def call_takeoff_service(self):
	"""调用起飞服务"""
	if not self.takeoff_client.wait_for_service(timeout_sec=1.5):
		self.get_logger().error('起飞服务不可用')
		return False
	request = ControlService.Request()
	request.req = 'takeoff' # 纯字符串数据。起飞指令：'takeoff'不多空格
	future = self.takeoff_client.call_async(request)
	# future.add_done_callback(self.your_callback) # full async callback # 这里可以添加回调处理
	self.get_logger().info('起飞服务请求已发送')
	return True

def your_callback()

```