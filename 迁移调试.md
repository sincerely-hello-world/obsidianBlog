## rk3588s配置环境
下载镜像，烧录到SD卡，
```
$ lsb_release -a 
Distributor ID: Ubuntu
Description:    Ubuntu 20.04.6 LTS
Release:        20.04
Codename:       focal

$ uname -a
Linux orangepi5b 6.1.43-rockchip-rk3588 #1.0.10 SMP Thu Jul  4 01:52:00 CST 2024 aarch64 aarch64 aarch64 GNU/Linux

版本 Ubuntu20.04 focal 6.1.43-rockchip-rk3588(官方版本)
```

## 安装ros2

[Foxy ROS2安装](Foxy%20ROS2安装.md)


## 1. 安装nomachine？ 选配



## 2. 模块包
```bash
sudo apt install python3-pip  -y

sudo pip3 install python-periphery # GPIO驱动库
sudo pip3 install pyserial # 串口通信
sudo pip3 install pyrealsense2  # t265 传感器模块
sudo apt-get install  python3-dev -y


# opencv模块  cv_bridge模块！
sudo apt-get install -y ros-foxy-cv-bridge # cv-bridge在 ros2 cli默认不装，自己手动装上

# opencv会被上述依赖，自动安装，不需要特意指定 sudo apt-get install -y python3-opencv  # opencv

sudo apt-get install -y python3-numpy   # numpy


sudo pip3 install -y rknn_toolkit_lite2-x.y.z-cp38-cp38-linux_aarch64.whl # rknn-lite 图像推理
# 这个也可以，会默认匹配当前python版本，但最好指定版本sudo pip3 install   rknn-toolkit-lite2 -y # 当然，这个包也可以从github下载，本地安装

# sudo apt install subversion # 用svn来下载 github仓库子文件
# svn export https://github.com/airockchip/rknn-toolkit2/trunk/rknpu2/runtime/Linux/librknn_api/aarch64 # 没成功，有很多还没了解

# 如果遇到 无法加载rknn model v6版本模型, 更新 librknnrt.so 动态库，
# wget https://github.com/airockchip/rknn-toolkit2/blob/master/rknpu2/runtime/Linux/librknn_api/aarch64/librknnrt.so # 把最新的librknnrt.so下载下来
# sudo cp /usr/lib/librknnrt.so /usr/lib/librknnrt.so.backup
# sudo cp librknnrt.so /usr/lib/librknnrt.so
```
测试一下 opencv 和 cv_bridge的是否可以使用
```python
python3
import cv2 # 先导入cv2,再导入cv_bridge！
from cv_bridge import CvBridge
```
 
关于cv_bridge不兼容，如果发生，需要下载源码，重新编译安装（未遇到）
```bash
git clone -b foxy https://github.com/ros-perception/vision_opencv.git
sudo apt install libboost-python-dev -y
cd ./vision_opencv/cv_bridge
colcon build 
```


## 开启/使能 开发板uart0 1 3 4 口

```bash
# 编辑 orangepiEnv.txt
sudo vim /boot/orangepiEnv.txt
# 添加一行：
overlays=uart0-m2 uart1-m1 uart3-m0 uart4-m0
# wq退出
reboot # 重启生效

ls /dev | grep ttyS # S0 1 3 4 为串口0 1 3 4; 串口2可能作为调试串口了
ttyS0
ttyS1
ttyS3
ttyS4
ttyS9
```
---
其他
```
# 添加pip3安装的一些包，到环境变量，解决warning
echo 'export PATH=/home/orangepi/.local/bin:$PATH' >> ~/.bashrc
source ~/.bashrc

# 只需执行一次，以后所有新终端都自动有 ROS 2 环境
# echo "source /opt/ros/foxy/setup.bash" >> ~/.bashrc 
# source  ~/.bashrc 
# >> 表示追加写入， > 表示覆盖写入（千万别覆盖写入）
```

---
# 项目迁移
启动脚本：
```
#!/bin/bash

source /opt/ros/foxy/setup.sh

# 获取当前脚本所在目录的绝对路径（处理软链接等情况更健壮）
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
echo 'current dir is: '$SCRIPT_DIR

# 获取上一层目录并赋值给一个变量
PARENT_DIR=$(dirname "$SCRIPT_DIR") ## parent dir
echo 'PARENT_DIR is: '$PARENT_DIR
 
ROS_LOG_DIR=$PARENT_DIR/run_log
echo 'ROS_LOG_DIR dir is: '$ROS_LOG_DIR
export ROS_LOG_DIR=$PARENT_DIR/run_log


STEUP_path=$PARENT_DIR/UAV_CAR/install/setup.bash 
echo 'STEUP_path is:'$STEUP_path
source $STEUP_path

ros2 launch uav_car_launch uav_car_drone.launch.py

```


## 创建GPIO用户组，可以调用GPIO

```bash
# 首先，我们需要创建一个新的用户组，并将我们的用户添加到该组中。这将允许我们以该用户组的权限访问GPIO。
sudo groupadd gpio
sudo usermod -aG gpio $USER
# 执行上述命令后，需要重新登录或使用`newgrp gpio`命令来切换到新的用户组。


```